webpackJsonp([17],{"3rEl":function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,".CodeMirror{border:1px solid #eee;height:auto;font-family:Ubuntu Mono,Menlo,Consolas,monospace;font-size:13px;line-height:1.1em}.CodeMirror,.CodeMirror-scroll{min-height:calc(100vh - 350px)}.CodeMirror-gutters{left:0!important}",""])},J01r:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("xQUo"),r=i("kBAq"),o=!1;var s=function(e){o||i("K7+4")},n=i("VU/8")(a.a,r.a,!1,s,null,null);n.options.__file="pages/api/email.vue",t.default=n.exports},"K7+4":function(e,t,i){var a=i("3rEl");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("213f71af",a,!1,{sourceMap:!1})},kBAq:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("v-snackbar",{attrs:{top:"",timeout:e.snackbarTimeout,color:e.snackbarColor},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v("\n    "+e._s(e.snackbarText)+"\n    "),i("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(t){e.snackbar=!1}}},[e._v("Close")])],1),i("v-content",[i("v-container",{attrs:{fluid:"",tag:"section",id:"grid"}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{"d-flex":"",xs12:"","order-xs5":""}},[i("v-layout",{attrs:{column:""}},[i("v-flex",{staticClass:"display mb-2",attrs:{tag:"h1"}},[e._v("\n              API - Email\n              \n              "),"templates"==e.state?i("span",["templates"==e.state?i("v-btn",{staticStyle:{float:"right"},attrs:{color:"success"},on:{click:function(t){e.state="templates",e.dialog.template=!0}}},[e._v("New Template")]):e._e(),"templates"==e.state?i("v-btn",{staticStyle:{float:"right"},attrs:{color:"orange"},on:{click:function(t){e.state="providers"}}},[e._v("Providers")]):e._e()],1):e._e(),"providers"==e.state?i("span",["providers"==e.state?i("v-btn",{staticStyle:{float:"right"},attrs:{color:"success"},on:{click:function(t){e.state="providers",e.dialog.provider=!0}}},[e._v("New Provider")]):e._e(),"providers"==e.state?i("v-btn",{staticStyle:{float:"right"},attrs:{color:"orange"},on:{click:function(t){e.state="templates"}}},[e._v("Templates")]):e._e()],1):e._e()]),i("v-flex",[i("v-alert",{attrs:{type:"error",value:e.error}},[e._v("\n                "+e._s(e.error)+"\n              ")]),i("p",[e._v("The email API allows you to create custom email templates with multiple providers, then simply use a POST request to send the email.")]),"templates"==e.state?i("div",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.tableHeaders.template,items:e.items.template,"hide-actions":"",loading:e.tableLoading},scopedSlots:e._u([{key:"items",fn:function(t){return[i("tr",{on:{click:function(i){i.stopPropagation(),e.tableExpand("template",t)}}},[i("td",[i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){i.stopPropagation(),e.editItem("template",t.item)}}},[e._v(e._s(t.item.name))])]),i("td",[i("a",{attrs:{href:e.loggedUser.sub+"/api/email/"+t.item.slug,target:"_blank"}},[e._v(e._s(t.item.slug))])]),i("td",[e._v(e._s(t.item.subject))]),i("td",[e._v(e._s(t.item.type))]),i("td",[i("v-tooltip",{attrs:{left:""}},[i("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{slot:"activator",icon:""},on:{click:function(i){e.deleteItem("template",t.item)}},slot:"activator"},[i("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1),i("span",[e._v("Delete")])],1),i("v-tooltip",{attrs:{left:""}},[i("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{slot:"activator",icon:""},on:{click:function(i){e.previewItem("preview",t.item)}},slot:"activator"},[i("v-icon",{attrs:{color:"light-blue lighten-1"}},[e._v("visibility")])],1),i("span",[e._v("Preview")])],1)],1)])]}}])},[i("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"}),i("template",{slot:"no-data"},[e._v("\n                    You have not added any email templates.\n                  ")])],2)],1):e._e(),"providers"==e.state?i("div",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.tableHeaders.provider,items:e.items.provider,"hide-actions":"",loading:e.tableLoading},scopedSlots:e._u([{key:"items",fn:function(t){return[i("tr",[i("td",[i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){i.stopPropagation(),e.editItem("provider",t.item)}}},[e._v(e._s(t.item.host))])]),i("td",[e._v(e._s(t.item.limit))]),i("td",[e._v(e._s(t.item.limit_sent))]),i("td",[i("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{icon:""},on:{click:function(i){e.deleteItem("provider",t.item)}}},[i("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1),"Yes"==t.item.debug?i("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{icon:""},on:{click:function(i){i.stopPropagation(),e.tableExpand("provider",t)}}},[i("v-icon",{attrs:{color:"blue-grey darken-2"}},[e._v("bug_report")])],1):e._e()],1)])]}},{key:"expand",fn:function(t){return[i("v-data-table",{attrs:{headers:e.expandedTableHeaders,items:t.item.ownAmsemaildebug,"hide-actions":""},scopedSlots:e._u([{key:"items",fn:function(t){return[i("tr",{on:{click:function(e){e.stopPropagation(),t.expanded=!t.expanded}}},[i("td",[e._v(e._s(t.item.date))]),i("td",[e._v(e._s(t.item.from))]),i("td",[e._v(e._s(t.item.to))]),i("td",[e._v(e._s(t.item.subject))]),i("td",[i("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{icon:""},on:{click:function(i){i.stopPropagation(),e.deleteLog(t.item)}}},[i("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1)],1)])]}},{key:"expand",fn:function(t){return[i("v-card",{attrs:{flat:""}},[i("v-card-text",{domProps:{innerHTML:e._s(t.item.log?"<pre>"+t.item.log.replace(/<br\s*[\/]?>/gi,"")+"</pre>":"")}})],1)]}}])},[i("template",{slot:"no-data"},[e._v("\n                        "+e._s(e.tableLoading?"Fetching data, please wait...":"No debug logs have been recorded.")+"\n                      ")])],2)]}}])},[i("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"}),i("template",{slot:"no-data"},[e._v("\n                    You have not added any email providers.\n                  ")])],2)],1):e._e()],1)],1)],1)],1)],1),i("v-dialog",{attrs:{"max-width":"600px",scrollable:""},model:{value:e.dialog.provider,callback:function(t){e.$set(e.dialog,"provider",t)},expression:"dialog.provider"}},[i("v-card",{attrs:{tile:""}},[i("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[i("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.close("provider")}}},[i("v-icon",[e._v("close")])],1),i("v-toolbar-title",[e._v(e._s(-1===e.editingIndex.provider?"New":"Edit")+" Provider")]),i("v-spacer"),i("v-toolbar-items",[i("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(t){e.save("provider")}}},[e._v("Save")])],1)],1),i("v-card-text",{staticStyle:{padding:"0px"}},[i("v-card",{attrs:{flat:""}},[i("v-card-text",[i("v-form",{ref:"formprovider",attrs:{"lazy-validation":""},model:{value:e.valid.provider,callback:function(t){e.$set(e.valid,"provider",t)},expression:"valid.provider"}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"Host:",placeholder:"",required:"",hint:"Enter the SMTP connection hostname."},model:{value:e.editingItem.provider.host,callback:function(t){e.$set(e.editingItem.provider,"host",t)},expression:"editingItem.provider.host"}}),i("v-text-field",{attrs:{label:"Username:",placeholder:"",required:"",hint:"Enter the SMTP connection username."},model:{value:e.editingItem.provider.username,callback:function(t){e.$set(e.editingItem.provider,"username",t)},expression:"editingItem.provider.username"}})],1),i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"Port:",placeholder:"",required:"",hint:"Enter the SMTP connection port."},model:{value:e.editingItem.provider.port,callback:function(t){e.$set(e.editingItem.provider,"port",t)},expression:"editingItem.provider.port"}}),i("v-text-field",{attrs:{label:"Password:",placeholder:"",required:"",hint:"Enter the SMTP connection password."},model:{value:e.editingItem.provider.password,callback:function(t){e.$set(e.editingItem.provider,"password",t)},expression:"editingItem.provider.password"}})],1)],1),i("v-select",{attrs:{items:["None","TLS","SSL"],label:"Encryption:",hint:"Choose the SMTP connection encryption type."},model:{value:e.editingItem.provider.encryption,callback:function(t){e.$set(e.editingItem.provider,"encryption",t)},expression:"editingItem.provider.encryption"}}),i("v-text-field",{attrs:{label:"Message Limit:",placeholder:"",required:"",hint:"Enter the SMTP message limit."},model:{value:e.editingItem.provider.limit,callback:function(t){e.$set(e.editingItem.provider,"limit",t)},expression:"editingItem.provider.limit"}}),i("v-select",{attrs:{items:["Yes","No"],label:"Debug:"},model:{value:e.editingItem.provider.debug,callback:function(t){e.$set(e.editingItem.provider,"debug",t)},expression:"editingItem.provider.debug"}}),"Yes"===e.editingItem.provider.debug?i("p",{staticStyle:{"margin-top":"-20px",color:"rgba(0,0,0,0.54)","font-size":"12px"}},[e._v("All emails will be logged and shown in table.")]):e._e()],1)],1)],1)],1),i("div",{staticStyle:{flex:"1 1 auto"}})],1)],1),i("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",scrollable:""},model:{value:e.dialog.template,callback:function(t){e.$set(e.dialog,"template",t)},expression:"dialog.template"}},[i("v-card",{attrs:{tile:""}},[i("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[i("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.close("template")}}},[i("v-icon",[e._v("close")])],1),i("v-toolbar-title",[e._v(e._s(-1===e.editingIndex.template?"New":"Edit")+" Template")]),i("v-spacer"),i("v-toolbar-items",[i("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(t){e.save("template")}}},[e._v("Save")])],1)],1),i("v-card-text",{staticStyle:{padding:"0px"}},[i("v-card",{attrs:{flat:""}},[i("v-card-text",[i("v-form",{ref:"formtemplate",attrs:{"lazy-validation":""},model:{value:e.valid.template,callback:function(t){e.$set(e.valid,"template",t)},expression:"valid.template"}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"Name:",placeholder:"",required:"",hint:"Enter the name of the email template."},model:{value:e.editingItem.template.name,callback:function(t){e.$set(e.editingItem.template,"name",t)},expression:"editingItem.template.name"}}),i("v-text-field",{attrs:{label:"Subject:",placeholder:"",required:"",hint:"Enter the email subject for this template."},model:{value:e.editingItem.template.subject,callback:function(t){e.$set(e.editingItem.template,"subject",t)},expression:"editingItem.template.subject"}}),i("v-select",{attrs:{items:["HTML","Plain"],label:"Type:",hint:"Choose the email template content type."},model:{value:e.editingItem.template.type,callback:function(t){e.$set(e.editingItem.template,"type",t)},expression:"editingItem.template.type"}})],1),i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"From:",placeholder:"",required:"",hint:"Enter the from email address."},model:{value:e.editingItem.template.from,callback:function(t){e.$set(e.editingItem.template,"from",t)},expression:"editingItem.template.from"}}),i("v-text-field",{attrs:{label:"Reply To:",placeholder:"",required:"",hint:"Enter the reply to email address."},model:{value:e.editingItem.template.replyto,callback:function(t){e.$set(e.editingItem.template,"replyto",t)},expression:"editingItem.template.replyto"}}),i("v-text-field",{attrs:{label:"Send Key:",placeholder:"",hint:"Enter a key which is required before sending email."},model:{value:e.editingItem.template.key,callback:function(t){e.$set(e.editingItem.template,"key",t)},expression:"editingItem.template.key"}})],1)],1),i("h3",[e._v("Template Source")]),i("no-ssr",{attrs:{placeholder:"Loading..."}},[i("codemirror",{attrs:{options:e.cmOption},model:{value:e.editingItem.template.source,callback:function(t){e.$set(e.editingItem.template,"source",t)},expression:"editingItem.template.source"}})],1)],1)],1)],1)],1),i("div",{staticStyle:{flex:"1 1 auto"}})],1)],1),i("v-dialog",{attrs:{"max-width":"900px",scrollable:""},model:{value:e.dialog.preview,callback:function(t){e.$set(e.dialog,"preview",t)},expression:"dialog.preview"}},[i("v-card",{attrs:{tile:""}},[i("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[i("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.close("preview")}}},[i("v-icon",[e._v("close")])],1),i("v-toolbar-title",[e._v("Preview Template")]),i("v-spacer")],1),i("v-card-text",{staticStyle:{padding:"0px"}},[i("iframe",{staticStyle:{width:"100%",height:"calc(100vh - 200px)"},attrs:{srcdoc:e.editingItem.template.source,frameBorder:"0"}})]),i("div",{staticStyle:{flex:"1 1 auto"}})],1)],1)],1)],1)};a._withStripped=!0;var r={render:a,staticRenderFns:[]};t.a=r},xQUo:function(e,t,i){"use strict";var a=i("woOf"),r=i.n(a),o=i("Xxa5"),s=i.n(o),n=i("exGp"),l=i.n(n),d=i("Dd8w"),c=i.n(d),p=i("NYxO"),m=(i("4swq"),i("mtWM")),v=i.n(m);t.a={middleware:["authenticated"],components:{},computed:c()({},Object(p.mapGetters)({isAuthenticated:"auth/isAuthenticated",loggedUser:"auth/loggedUser",loggedToken:"auth/loggedToken"})),data:function(){return{state:"templates",error:"",cmOption:{smartIndent:!1,indentWithTabs:!0,tabSize:4,indentUnit:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,keyMap:"sublime",mode:"text/html"},snackbar:!1,snackbarColor:"green",snackbarText:"",snackbarTimeout:5e3,items:{template:[],provider:[]},tableLoading:!0,tableHeaders:{template:[{text:"Name",value:"name"},{text:"Slug",value:"slug"},{text:"Subject",value:"subject"},{text:"Type",value:"type"},{text:"Actions",value:"name",sortable:!1,align:"right"}],provider:[{text:"Host",value:"host"},{text:"Limit",value:"limit"},{text:"Sent",value:"limit_sent"},{text:"Actions",value:"host",sortable:!1,align:"right"}]},expandedTableHeaders:[{text:"Date",value:"date"},{text:"From",value:"from"},{text:"To",value:"to"},{text:"Subject",value:"subject"},{text:"Actions",value:"name",sortable:!1,align:"right"}],dialog:{template:!1,provider:!1,preview:!1},editingIndex:{template:-1,provider:-1},editingItem:{template:{id:-1,name:"",type:"HTML",subject:"",from:"",replyto:"",key:"",source:""},provider:{id:-1,host:"",username:"",password:"",encryption:"None",port:"",limit:"",debug:"No"}},defaultItem:{template:{id:-1,name:"",type:"HTML",subject:"",from:"",replyto:"",key:"",source:""},provider:{id:-1,host:"",username:"",password:"",encryption:"None",port:"",limit:"",debug:"No"}},valid:{template:!0,provider:!0},moduleRules:[function(e){return!!e||"Module name is required"},function(e){return e&&e.length<=100||"Module name must be less than 100 characters"}],versionRules:[function(e){return!!e||"Version is required"},function(e){return e&&Number(e)||"Version must be a number"}]}},mounted:function(){this.initialize()},watch:{"dialog.template":function(e){e||this.close("template")},"dialog.provider":function(e){e||this.close("provider")},"dialog.preview":function(e){e||this.close("preview")}},methods:{initialize:function(){var e=l()(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.loggedUser||this.$router.replace("/servers"),v.a.defaults.headers.common.Authorization="Bearer "+this.loggedToken,e.next=5,v.a.get(this.loggedUser.sub+"/api/ams/email/template");case 5:return t=e.sent,this.items.template=t.data.data,e.next=9,v.a.get(this.loggedUser.sub+"/api/ams/email/provider");case 9:t=e.sent,this.items.provider=t.data.data,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),this.error="Could not fetch data from server.";case 16:this.tableLoading=!1;case 17:case"end":return e.stop()}},e,this,[[0,13]])}));return function(){return e.apply(this,arguments)}}(),editItem:function(e,t){this.editingIndex[e]=this.items[e].indexOf(t),this.editingItem[e]=r()({},t),this.dialog[e]=!0},previewItem:function(e,t){this.editingIndex.template=this.items.template.indexOf(t),this.editingItem.template=r()({},t),this.dialog[e]=!0},deleteItem:function(){var e=l()(s.a.mark(function e(t,i){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.items[t].indexOf(i),this.items[t].splice(a,1),e.prev=2,this.loggedUser||this.$router.replace("/servers"),v.a.defaults.headers.common.Authorization="Bearer "+this.loggedToken,e.next=7,v.a.delete(this.loggedUser.sub+"/api/ams/email/"+t,{data:i});case 7:e.sent,this.snackbar=!0,this.snackbarText="Email "+t+" successfully deleted.",e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),this.error="Could not delete email "+t+" from server.";case 15:case"end":return e.stop()}},e,this,[[2,12]])}));return function(t,i){return e.apply(this,arguments)}}(),save:function(){var e=l()(s.a.mark(function e(t){var i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i="form"+t,!this.$refs[i].validate()){e.next=18;break}return this.editingIndex[t]>-1?r()(this.items[t][this.editingIndex[t]],this.editingItem[t]):this.items[t].push(r()({},this.editingItem[t])),e.prev=3,this.loggedUser||this.$router.replace("/servers"),v.a.defaults.headers.common.Authorization="Bearer "+this.loggedToken,e.next=8,v.a.post(this.loggedUser.sub+"/api/ams/email/"+t,this.editingItem[t]);case 8:e.sent,this.snackbar=!0,this.snackbarText="Email "+t+" successfully saved.",e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.error="Could not save email "+t+" to server.";case 16:-1===this.editingIndex[t]&&this.close(t),this.initialize();case 18:case"end":return e.stop()}},e,this,[[3,13]])}));return function(t){return e.apply(this,arguments)}}(),tableExpand:function(e,t){t.expanded=!t.expanded},close:function(e){var t=this;this.dialog[e]=!1,setTimeout(function(){t.editingItem=r()({},t.defaultItem),t.editingIndex={template:-1,provider:-1}},300)}}}}});